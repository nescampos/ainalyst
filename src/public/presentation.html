<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Research Presentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/theme/black.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/monokai.min.css">
    <style>
        .reveal h1, .reveal h2, .reveal h3 {
            text-transform: none;
        }
        .reveal ul, .reveal ol {
            margin-bottom: 1rem;
        }
        .reveal li {
            margin-bottom: 0.5rem;
        }
        .reveal table {
            margin: 1rem auto;
            border-collapse: collapse;
            width: 90%;
        }
        .reveal table, .reveal th, .reveal td {
            border: 1px solid #ddd;
            padding: 0.5rem;
        }
        .reveal th {
            background-color: #333;
        }
        .reveal pre {
            width: 90%;
            margin: 1rem auto;
            font-size: 0.7em;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
        }
        .back-button:hover {
            background: rgba(0,0,0,0.8);
        }
        
        /* Ajustes para mejor visualización del contenido */
        .reveal .slides section {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .reveal .slides section .markdown-content {
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        
        /* Mejorar el tamaño de texto para mejor legibilidad */
        .reveal {
            font-size: 80%;
        }
        
        .reveal h1 {
            font-size: 2.5em;
        }
        
        .reveal h2 {
            font-size: 1.8em;
        }
        
        .reveal h3 {
            font-size: 1.4em;
        }
        
        .reveal p, .reveal li {
            font-size: 1.2em;
            line-height: 1.4;
        }
        
        /* Mejorar el contraste de los enlaces */
        .reveal a {
            color: #42affa;
            text-decoration: underline;
        }
        
        .reveal a:hover {
            color: #7bd0ff;
        }
        
        /* Fullscreen hint */
        .fullscreen-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="goBack()">
        <i class="fas fa-arrow-left"></i> Back to Results
    </button>
    
    <div class="fullscreen-hint">
        Press 'F' for fullscreen mode
    </div>
    
    <div class="reveal">
        <div class="slides" id="presentationContent">
            <!-- Presentation content will be loaded here -->
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/markdown/markdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/highlight/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.3.1/plugin/notes/notes.min.js"></script>
    <script>
        // Function to go back to results page
        function goBack() {
            window.parent.postMessage({action: 'closePresentation'}, '*');
        }
        
        // Get folder name from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const folderName = urlParams.get('folder');
        
        if (folderName) {
            // Load presentation content
            fetch(`/api/results/${folderName}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // Convert markdown to slides using Reveal.js markdown format
                    const slidesMarkdown = convertMarkdownToRevealFormat(data.reportContent);
                    document.getElementById('presentationContent').innerHTML = slidesMarkdown;
                    
                    // Initialize Reveal.js
                    Reveal.initialize({
                        controls: true,
                        progress: true,
                        center: false,
                        hash: true,
                        transition: 'slide',
                        width: '100%',
                        height: '100%',
                        margin: 0.1,
                        minScale: 0.2,
                        maxScale: 2.0,
                        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
                    });
                })
                .catch(error => {
                    console.error('Error loading presentation:', error);
                    document.getElementById('presentationContent').innerHTML = 
                        `<section><h2>Error loading presentation</h2><p>${error.message}</p></section>`;
                });
        }
        
        // Function to convert markdown to Reveal.js format
        function convertMarkdownToRevealFormat(markdown) {
            // Split markdown into sections by slide separators (---)
            const slides = markdown.split(/\n---\n/);
            let slidesHtml = '';
            
            // Process each slide
            for (let i = 0; i < slides.length; i++) {
                const slideContent = slides[i].trim();
                if (slideContent) {
                    // Check if this is the title slide (first slide with # header)
                    if (i === 0 && slideContent.match(/^#\s/)) {
                        slidesHtml += `<section data-markdown><textarea data-template>\n${slideContent}\n</textarea></section>\n`;
                    } else {
                        // For other slides, wrap content appropriately
                        slidesHtml += `<section data-markdown><textarea data-template>\n${slideContent}\n</textarea></section>\n`;
                    }
                }
            }
            
            return slidesHtml;
        }
    </script>
</body>
</html>